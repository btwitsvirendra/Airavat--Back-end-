generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== USER & AUTH ====================

model users {
  user_id        BigInt    @id @default(autoincrement()) @db.BigInt
  email          String    @unique @db.VarChar(255)
  password_hash  String    @db.Text
  full_name      String?   @db.VarChar(255) // User's full name
  phone          String?   @db.VarChar(20) // Contact number
  role           String    @default("business_owner") @db.VarChar(20) // 'business_owner', 'admin'
  is_verified    Boolean   @default(false)
  status         String    @default("active") @db.VarChar(20) // 'active', 'inactive', 'suspended'
  email_verified Boolean   @default(false)
  last_login     DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @default(now()) @updatedAt

  // Relations - One user can have multiple businesses
  businesses business[] @relation("user_businesses")
  notifications notifications[] @relation("user_notifications")
  cart_items cart_items[]

  @@map("users")
}

// ==================== BUSINESS ====================

model business_types {
  business_type_id BigInt   @id @default(autoincrement()) @db.BigInt
  type_name        String   @db.VarChar(100)
  description      String?  @db.Text
  created_at       DateTime @default(now())

  // Relations
  businesses business[]

  @@map("business_types")
}

model business {
  business_id           BigInt    @id @default(autoincrement()) @db.BigInt
  user_id               BigInt    @db.BigInt // Required - every business must have an owner
  business_type_id      BigInt?   @db.BigInt
  business_name         String    @db.VarChar(255)
  display_name          String?   @db.VarChar(255)
  company_legal_name    String?   @db.VarChar(255)
  description           String?   @db.Text
  
  // Indian Business Identifiers
  gst_number            String?   @db.VarChar(15) // GST Number (15 chars)
  pan_number            String?   @db.VarChar(10) // PAN Number (10 chars)
  msme_number           String?   @db.VarChar(50) // MSME/Udyog Aadhaar
  
  // Business Roles - can be buyer, seller, or both
  can_buy               Boolean   @default(true) // Can purchase products
  can_sell              Boolean   @default(false) // Can list products for sale
  
  license_number        String?   @db.VarChar(100)
  tax_number            String?   @db.VarChar(100)
  website_url           String?   @db.VarChar(255)
  employee_count        Int?
  year_established      Int?
  is_verified           Boolean   @default(false)
  verification_level    String?   @db.VarChar(50)
  address_line1         String?   @db.VarChar(255)
  address_line2         String?   @db.VarChar(255)
  city                  String?   @db.VarChar(100)
  state                 String?   @db.VarChar(100)
  country               String?   @db.VarChar(100)
  pincode               String?   @db.VarChar(20)
  primary_contact_phone String?   @db.VarChar(40)
  primary_contact_email String?   @db.VarChar(255)
  verified_at           DateTime?
  verified_by           BigInt?   @db.BigInt
  created_at            DateTime  @default(now())
  updated_at            DateTime  @default(now()) @updatedAt

  // Relations
  business_type business_types? @relation(fields: [business_type_id], references: [business_type_id])
  user          users            @relation("user_businesses", fields: [user_id], references: [user_id], onDelete: Cascade)

  documents          business_documents[]   @relation("business_documents")
  buyer_connections  business_connections[] @relation("buyer_connections")
  seller_connections business_connections[] @relation("seller_connections")

  products          products[]   @relation("business_products")
  buyer_orders      orders[]     @relation("buyer_orders")
  seller_orders     orders[]     @relation("seller_orders")
  buyer_inquiries   inquiries[]  @relation("buyer_inquiries")
  seller_quotations quotations[] @relation("seller_quotations")
  reviewer_reviews  reviews[]    @relation("reviewer_reviews")
  reviewed_reviews  reviews[]    @relation("reviewed_reviews")
  
  // Chat relations
  buyer_conversations  conversations[] @relation("buyer_conversations")
  seller_conversations conversations[] @relation("seller_conversations")
  sent_messages        chat_messages[] @relation("message_senders")
  notifications        notifications[] @relation("business_notifications")

  // Payment & Invoice relations
  seller_payment_links payment_links[] @relation("seller_payment_links")
  buyer_payment_links payment_links[] @relation("buyer_payment_links")
  seller_invoices      invoices[]      @relation("seller_invoices")
  buyer_invoices       invoices[]      @relation("buyer_invoices")
  buyer_cart_items      cart_items[]    @relation("buyer_cart_items")

  @@index([user_id])
  @@index([business_type_id])
  @@map("business")
}

model business_documents {
  document_id   BigInt    @id @default(autoincrement()) @db.BigInt
  business_id   BigInt    @db.BigInt
  document_type String    @db.VarChar(50) // 'license', 'tax_certificate', 'incorporation', etc.
  document_name String?   @db.VarChar(255)
  document_url  String    @db.Text
  is_verified   Boolean   @default(false)
  verified_at   DateTime?
  verified_by   BigInt?   @db.BigInt
  uploaded_at   DateTime  @default(now())

  // Relations
  business business @relation("business_documents", fields: [business_id], references: [business_id], onDelete: Cascade)

  @@index([business_id])
  @@map("business_documents")
}

model business_connections {
  connection_id      BigInt   @id @default(autoincrement()) @db.BigInt
  buyer_business_id  BigInt   @db.BigInt
  seller_business_id BigInt   @db.BigInt
  following_since    DateTime @default(now())
  is_following       Boolean  @default(true)
  created_at         DateTime @default(now())

  // Relations
  buyer_business  business @relation("buyer_connections", fields: [buyer_business_id], references: [business_id], onDelete: Cascade)
  seller_business business @relation("seller_connections", fields: [seller_business_id], references: [business_id], onDelete: Cascade)

  @@unique([buyer_business_id, seller_business_id])
  @@index([buyer_business_id])
  @@index([seller_business_id])
  @@map("business_connections")
}

// ==================== CATEGORIES ====================

model categories {
  category_id        BigInt   @id @default(autoincrement()) @db.BigInt
  parent_category_id BigInt?  @db.BigInt
  category_name      String   @db.VarChar(255)
  slug               String?  @unique @db.VarChar(255)
  description        String?  @db.Text
  is_active          Boolean  @default(true)
  display_order      Int?
  created_at         DateTime @default(now())
  updated_at         DateTime @default(now()) @updatedAt

  // Self-relation for hierarchy
  parent_category categories?  @relation("category_hierarchy", fields: [parent_category_id], references: [category_id])
  subcategories   categories[] @relation("category_hierarchy")

  // Relations
  products products[]

  @@index([parent_category_id])
  @@map("categories")
}

// ==================== REFERENCE TABLES ====================

model currencies {
  currency_id   Int      @id @default(autoincrement())
  currency_code String   @unique @db.VarChar(3) // ISO 4217 code (USD, EUR, GBP, etc.)
  currency_name String   @db.VarChar(100)
  symbol        String   @db.VarChar(10)
  is_active     Boolean  @default(true)
  display_order Int?
  created_at    DateTime @default(now())

  // Relations
  products     products[]
  orders       orders[]
  payment_links payment_links[]
  invoices     invoices[]

  @@map("currencies")
}

model price_units {
  unit_id       Int      @id @default(autoincrement())
  unit_code     String   @unique @db.VarChar(20) // 'piece', 'kg', 'ton', 'liter', etc.
  unit_name     String   @db.VarChar(100)
  unit_type     String   @db.VarChar(50) // 'weight', 'volume', 'length', 'quantity', etc.
  abbreviation  String?  @db.VarChar(10)
  is_active     Boolean  @default(true)
  display_order Int?
  created_at    DateTime @default(now())

  // Relations
  products products[]

  @@map("price_units")
}

// ==================== PRODUCTS ====================

model products {
  product_id         BigInt   @id @default(autoincrement()) @db.BigInt
  business_id        BigInt?  @db.BigInt
  category_id        BigInt   @db.BigInt
  currency_id        Int      @default(1) // Reference to currencies table
  price_unit_id      Int?     // Reference to price_units table
  product_name       String   @db.VarChar(255)
  slug               String?  @unique @db.VarChar(255)
  description        String?  @db.Text
  specifications     String?  @db.Text
  base_price         Decimal? @db.Decimal(15, 2)
  min_order_quantity Int?
  max_order_quantity Int?
  unit_in_stock      Int?
  available_quantity Int?
  hs_code            String?  @db.VarChar(20)
  brand              String?  @db.VarChar(100)
  manufacturer       String?  @db.VarChar(255)
  country_of_origin  String?  @db.VarChar(100)
  status             String   @default("draft") @db.VarChar(20) // 'draft', 'active', 'inactive', 'discontinued'
  is_featured        Boolean  @default(false)
  created_at         DateTime @default(now())
  updated_at         DateTime @default(now()) @updatedAt

  // Relations
  category   categories   @relation(fields: [category_id], references: [category_id])
  business   business?    @relation("business_products", fields: [business_id], references: [business_id])
  currency   currencies   @relation(fields: [currency_id], references: [currency_id])
  price_unit price_units? @relation(fields: [price_unit_id], references: [unit_id])

  images        product_images[]
  order_items   order_items[]
  inquiries     inquiries[]
  conversations conversations[] @relation("conversation_products")
  payment_link_items payment_link_items[]
  invoice_items invoice_items[]
  cart_items    cart_items[]

  @@index([category_id])
  @@index([business_id])
  @@index([currency_id])
  @@index([price_unit_id])
  @@index([status])
  @@map("products")
}

model product_images {
  image_id      BigInt   @id @default(autoincrement()) @db.BigInt
  product_id    BigInt   @db.BigInt
  image_url     String   @db.Text
  display_order Int?
  is_primary    Boolean  @default(false)
  uploaded_at   DateTime @default(now())

  // Relations
  product products @relation(fields: [product_id], references: [product_id], onDelete: Cascade)

  @@index([product_id])
  @@map("product_images")
}

// ==================== ORDERS ====================

model orders {
  order_id               BigInt    @id @default(autoincrement()) @db.BigInt
  buyer_business_id      BigInt    @db.BigInt
  seller_business_id     BigInt    @db.BigInt
  currency_id            Int       @default(1) // Reference to currencies table
  order_number           String?   @unique @db.VarChar(100)
  status                 String    @default("pending") @db.VarChar(50) // 'pending', 'confirmed', 'processing', 'shipped', 'delivered', 'cancelled'
  tax_amount             Decimal?  @db.Decimal(15, 2)
  discount_amount        Decimal?  @db.Decimal(15, 2)
  shipping_amount        Decimal?  @db.Decimal(15, 2)
  final_amount           Decimal?  @db.Decimal(15, 2)
  delivery_address       String?   @db.Text
  delivery_city          String?   @db.VarChar(100)
  delivery_state         String?   @db.VarChar(100)
  delivery_pincode       String?   @db.VarChar(20)
  delivery_country       String?   @db.VarChar(100)
  expected_delivery_date DateTime?
  payment_status         String    @default("pending") @db.VarChar(50) // 'pending', 'paid', 'partial', 'failed'
  buyer_notes            String?   @db.Text
  seller_notes           String?   @db.Text
  created_at             DateTime  @default(now())
  updated_at             DateTime  @default(now()) @updatedAt

  // Relations
  buyer_business  business   @relation("buyer_orders", fields: [buyer_business_id], references: [business_id])
  seller_business business   @relation("seller_orders", fields: [seller_business_id], references: [business_id])
  currency        currencies @relation(fields: [currency_id], references: [currency_id])

  order_items      order_items[]
  reviews          reviews[]
  conversations    conversations[] @relation("conversation_orders")
  invoices         invoices[]
  delivery_options delivery_options[]

  @@index([buyer_business_id])
  @@index([seller_business_id])
  @@index([currency_id])
  @@index([status])
  @@map("orders")
}

model order_items {
  order_item_id BigInt   @id @default(autoincrement()) @db.BigInt
  order_id      BigInt   @db.BigInt
  product_id    BigInt   @db.BigInt
  product_name  String?  @db.VarChar(255)
  quantity_unit Int?
  unit_price    Decimal? @db.Decimal(15, 2)
  discount_rate Decimal? @db.Decimal(5, 2)
  total_price   Decimal? @db.Decimal(15, 2)
  tax_rate      Decimal? @db.Decimal(5, 2)
  hs_code       String?  @db.VarChar(20)

  // Relations
  order   orders   @relation(fields: [order_id], references: [order_id], onDelete: Cascade)
  product products @relation(fields: [product_id], references: [product_id])

  @@index([order_id])
  @@index([product_id])
  @@map("order_items")
}

// ==================== REVIEWS ====================

model reviews {
  review_id              BigInt   @id @default(autoincrement()) @db.BigInt
  order_id               BigInt   @db.BigInt
  reviewer_business_id   BigInt   @db.BigInt
  reviewed_business_id   BigInt   @db.BigInt
  rating                 Int // 1-5
  review_text            String?  @db.Text
  product_quality_rating Int? // 1-5
  delivery_rating        Int? // 1-5
  communication_rating   Int? // 1-5
  is_approved            Boolean  @default(false)
  created_at             DateTime @default(now())
  updated_at             DateTime @default(now()) @updatedAt

  // Relations
  order             orders   @relation(fields: [order_id], references: [order_id])
  reviewer_business business @relation("reviewer_reviews", fields: [reviewer_business_id], references: [business_id])
  reviewed_business business @relation("reviewed_reviews", fields: [reviewed_business_id], references: [business_id])

  @@index([order_id])
  @@index([reviewer_business_id])
  @@index([reviewed_business_id])
  @@map("reviews")
}

// ==================== INQUIRIES & QUOTATIONS ====================

model inquiries {
  inquiry_id        BigInt    @id @default(autoincrement()) @db.BigInt
  buyer_business_id BigInt    @db.BigInt
  product_id        BigInt?   @db.BigInt
  inquiry_title     String    @db.VarChar(255)
  description       String?   @db.Text
  required_quantity Int?
  budget_range      String?   @db.VarChar(100)
  expected_delivery DateTime?
  status            String    @default("open") @db.VarChar(50) // 'open', 'quoted', 'closed', 'expired'
  created_at        DateTime  @default(now())
  updated_at        DateTime  @default(now()) @updatedAt

  // Relations
  buyer_business business  @relation("buyer_inquiries", fields: [buyer_business_id], references: [business_id])
  product        products? @relation(fields: [product_id], references: [product_id])

  quotations    quotations[]
  conversations conversations[] @relation("conversation_inquiries")

  @@index([buyer_business_id])
  @@index([product_id])
  @@index([status])
  @@map("inquiries")
}

model quotations {
  quotation_id       BigInt   @id @default(autoincrement()) @db.BigInt
  inquiry_id         BigInt   @db.BigInt
  seller_business_id BigInt   @db.BigInt
  validity_days      Int?
  delivery_time_days Int?
  payment_terms      String?  @db.Text
  other_terms        String?  @db.Text
  status             String   @default("draft") @db.VarChar(50) // 'draft', 'sent', 'accepted', 'rejected', 'expired'
  setup              String?  @db.Text
  created_at         DateTime @default(now())
  updated_at         DateTime @default(now()) @updatedAt

  // Relations
  inquiry         inquiries @relation(fields: [inquiry_id], references: [inquiry_id])
  seller_business business  @relation("seller_quotations", fields: [seller_business_id], references: [business_id])

  @@index([inquiry_id])
  @@index([seller_business_id])
  @@index([status])
  @@map("quotations")
}

// ==================== CHAT & MESSAGING ====================

model conversations {
  conversation_id BigInt   @id @default(autoincrement()) @db.BigInt
  buyer_business_id BigInt @db.BigInt
  seller_business_id BigInt @db.BigInt
  product_id      BigInt?  @db.BigInt // Optional - can chat without product
  inquiry_id      BigInt?  @db.BigInt // Optional - can chat about inquiry
  order_id        BigInt?  @db.BigInt // Optional - can chat about order
  last_message_at DateTime?
  is_active       Boolean  @default(true)
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now()) @updatedAt

  // Relations
  buyer_business  business  @relation("buyer_conversations", fields: [buyer_business_id], references: [business_id])
  seller_business business @relation("seller_conversations", fields: [seller_business_id], references: [business_id])
  product         products? @relation("conversation_products", fields: [product_id], references: [product_id])
  inquiry         inquiries? @relation("conversation_inquiries", fields: [inquiry_id], references: [inquiry_id])
  order           orders? @relation("conversation_orders", fields: [order_id], references: [order_id])
  
  messages      chat_messages[]
  payment_links payment_links[]

  @@unique([buyer_business_id, seller_business_id, product_id])
  @@index([buyer_business_id])
  @@index([seller_business_id])
  @@index([product_id])
  @@index([last_message_at])
  @@map("conversations")
}

model chat_messages {
  message_id      BigInt   @id @default(autoincrement()) @db.BigInt
  conversation_id BigInt   @db.BigInt
  sender_business_id BigInt @db.BigInt
  message_type    String   @default("text") @db.VarChar(50) // 'text', 'product', 'quote', 'order', 'file', 'image'
  content         String?  @db.Text
  metadata        Json?    // For product links, quotes, orders, etc.
  is_read         Boolean  @default(false)
  read_at         DateTime?
  is_deleted      Boolean  @default(false)
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now()) @updatedAt

  // Relations
  conversation    conversations @relation(fields: [conversation_id], references: [conversation_id], onDelete: Cascade)
  sender_business business      @relation("message_senders", fields: [sender_business_id], references: [business_id])

  @@index([conversation_id])
  @@index([sender_business_id])
  @@index([created_at])
  @@index([is_read])
  @@map("chat_messages")
}

// ==================== NOTIFICATIONS ====================

model notifications {
  notification_id BigInt   @id @default(autoincrement()) @db.BigInt
  user_id         BigInt   @db.BigInt
  business_id     BigInt?  @db.BigInt // Optional - can be user-level or business-level
  type            String   @db.VarChar(50) // 'message', 'order', 'inquiry', 'quotation', 'review', 'system'
  title           String   @db.VarChar(255)
  message         String   @db.Text
  link            String?  @db.VarChar(500)
  metadata        Json?    // Additional data
  is_read         Boolean  @default(false)
  read_at         DateTime?
  created_at      DateTime @default(now())

  // Relations
  user     users      @relation("user_notifications", fields: [user_id], references: [user_id], onDelete: Cascade)
  business business?  @relation("business_notifications", fields: [business_id], references: [business_id])

  @@index([user_id])
  @@index([business_id])
  @@index([is_read])
  @@index([created_at])
  @@map("notifications")
}

// ==================== PAYMENT LINKS & NEGOTIATED PRICES ====================

model payment_links {
  payment_link_id    BigInt    @id @default(autoincrement()) @db.BigInt
  seller_business_id BigInt    @db.BigInt
  buyer_business_id  BigInt?   @db.BigInt // Nullable for public links
  conversation_id    BigInt?   @db.BigInt // Link to conversation where negotiated
  link_code          String    @unique @db.VarChar(100) // Unique code for the link
  title              String?   @db.VarChar(255)
  description        String?   @db.Text
  currency_id        Int       @default(1)
  total_amount       Decimal   @db.Decimal(15, 2)
  tax_amount         Decimal?  @db.Decimal(15, 2)
  discount_amount    Decimal?  @db.Decimal(15, 2)
  final_amount       Decimal   @db.Decimal(15, 2)
  status             String    @default("active") @db.VarChar(50) // 'active', 'used', 'expired', 'cancelled'
  expires_at         DateTime?
  is_negotiated      Boolean   @default(false) // True if prices were negotiated
  payment_gateway    String?   @db.VarChar(50) // 'razorpay', 'stripe', 'paypal', etc.
  payment_gateway_id String?   @db.VarChar(255) // Gateway's payment link ID
  metadata           Json?     // Additional payment gateway data
  created_at         DateTime  @default(now())
  updated_at         DateTime  @default(now()) @updatedAt
  used_at            DateTime?

  // Relations
  seller_business business   @relation("seller_payment_links", fields: [seller_business_id], references: [business_id])
  buyer_business  business?  @relation("buyer_payment_links", fields: [buyer_business_id], references: [business_id])
  conversation    conversations? @relation(fields: [conversation_id], references: [conversation_id])
  currency        currencies @relation(fields: [currency_id], references: [currency_id])

  payment_link_items payment_link_items[]
  invoices          invoices[]
  delivery_options  delivery_options[]

  @@index([seller_business_id])
  @@index([buyer_business_id])
  @@index([conversation_id])
  @@index([link_code])
  @@index([status])
  @@map("payment_links")
}

model payment_link_items {
  payment_link_item_id BigInt   @id @default(autoincrement()) @db.BigInt
  payment_link_id      BigInt   @db.BigInt
  product_id           BigInt   @db.BigInt
  product_name         String   @db.VarChar(255)
  quantity             Int
  negotiated_price     Decimal? @db.Decimal(15, 2) // Negotiated price per unit (if different from base)
  base_price           Decimal  @db.Decimal(15, 2) // Original product price
  unit_price           Decimal  @db.Decimal(15, 2) // Final price per unit (negotiated or base)
  discount_rate        Decimal? @db.Decimal(5, 2)
  tax_rate             Decimal? @db.Decimal(5, 2)
  total_price          Decimal  @db.Decimal(15, 2)
  notes                String?  @db.Text
  created_at           DateTime  @default(now())

  // Relations
  payment_link payment_links @relation(fields: [payment_link_id], references: [payment_link_id], onDelete: Cascade)
  product      products      @relation(fields: [product_id], references: [product_id])

  @@index([payment_link_id])
  @@index([product_id])
  @@map("payment_link_items")
}

// ==================== INVOICES ====================

model invoices {
  invoice_id        BigInt    @id @default(autoincrement()) @db.BigInt
  invoice_number    String    @unique @db.VarChar(100)
  order_id          BigInt?   @db.BigInt
  payment_link_id   BigInt?   @db.BigInt
  seller_business_id BigInt   @db.BigInt
  buyer_business_id BigInt   @db.BigInt
  currency_id       Int       @default(1)
  subtotal          Decimal   @db.Decimal(15, 2)
  tax_amount        Decimal?  @db.Decimal(15, 2)
  discount_amount   Decimal?  @db.Decimal(15, 2)
  shipping_amount  Decimal?  @db.Decimal(15, 2)
  total_amount      Decimal   @db.Decimal(15, 2)
  status            String    @default("draft") @db.VarChar(50) // 'draft', 'sent', 'paid', 'cancelled'
  invoice_date      DateTime  @default(now())
  due_date          DateTime?
  paid_at           DateTime?
  notes             String?   @db.Text
  pdf_url           String?   @db.Text
  created_at        DateTime  @default(now())
  updated_at        DateTime  @default(now()) @updatedAt

  // Relations
  order            orders?    @relation(fields: [order_id], references: [order_id])
  payment_link     payment_links? @relation(fields: [payment_link_id], references: [payment_link_id])
  seller_business  business  @relation("seller_invoices", fields: [seller_business_id], references: [business_id])
  buyer_business   business  @relation("buyer_invoices", fields: [buyer_business_id], references: [business_id])
  currency         currencies @relation(fields: [currency_id], references: [currency_id])

  invoice_items invoice_items[]

  @@index([order_id])
  @@index([payment_link_id])
  @@index([seller_business_id])
  @@index([buyer_business_id])
  @@index([invoice_number])
  @@index([status])
  @@map("invoices")
}

model invoice_items {
  invoice_item_id BigInt   @id @default(autoincrement()) @db.BigInt
  invoice_id      BigInt   @db.BigInt
  product_id      BigInt   @db.BigInt
  product_name    String   @db.VarChar(255)
  quantity        Int
  unit_price      Decimal  @db.Decimal(15, 2)
  discount_rate   Decimal? @db.Decimal(5, 2)
  tax_rate        Decimal? @db.Decimal(5, 2)
  total_price     Decimal  @db.Decimal(15, 2)
  description     String?  @db.Text
  created_at      DateTime @default(now())

  // Relations
  invoice invoices @relation(fields: [invoice_id], references: [invoice_id], onDelete: Cascade)
  product products @relation(fields: [product_id], references: [product_id])

  @@index([invoice_id])
  @@index([product_id])
  @@map("invoice_items")
}

// ==================== CART ====================

model cart_items {
  cart_item_id    BigInt   @id @default(autoincrement()) @db.BigInt
  user_id         BigInt?  @db.BigInt // Nullable for guest carts
  business_id     BigInt?  @db.BigInt // Buyer business ID
  session_id      String?  @db.VarChar(255) // For guest carts
  product_id      BigInt   @db.BigInt
  quantity        Int
  negotiated_price Decimal? @db.Decimal(15, 2) // If price was negotiated
  delivery_option String?  @db.VarChar(50) // 'pickup', 'buyer_delivery', 'seller_delivery', 'platform_delivery'
  delivery_notes   String?  @db.Text
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now()) @updatedAt

  // Relations
  user     users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  business business? @relation("buyer_cart_items", fields: [business_id], references: [business_id], onDelete: Cascade)
  product  products  @relation(fields: [product_id], references: [product_id])

  @@unique([user_id, product_id, delivery_option])
  @@unique([business_id, product_id, delivery_option])
  @@unique([session_id, product_id, delivery_option])
  @@index([user_id])
  @@index([business_id])
  @@index([session_id])
  @@index([product_id])
  @@map("cart_items")
}

// ==================== DELIVERY OPTIONS ====================

model delivery_options {
  delivery_option_id BigInt   @id @default(autoincrement()) @db.BigInt
  order_id           BigInt?  @db.BigInt
  payment_link_id    BigInt?  @db.BigInt
  option_type        String   @db.VarChar(50) // 'pickup', 'buyer_delivery', 'seller_delivery', 'platform_delivery'
  delivery_partner   String?  @db.VarChar(255) // Name of delivery partner if buyer_delivery
  pickup_address     String?  @db.Text
  delivery_address   String?  @db.Text
  estimated_cost     Decimal? @db.Decimal(15, 2)
  estimated_days     Int?
  tracking_number    String?  @db.VarChar(255)
  status             String   @default("pending") @db.VarChar(50) // 'pending', 'confirmed', 'in_transit', 'delivered', 'cancelled'
  notes              String?  @db.Text
  created_at         DateTime @default(now())
  updated_at         DateTime @default(now()) @updatedAt

  // Relations
  order        orders?       @relation(fields: [order_id], references: [order_id])
  payment_link payment_links? @relation(fields: [payment_link_id], references: [payment_link_id])

  @@index([order_id])
  @@index([payment_link_id])
  @@index([status])
  @@map("delivery_options")
}